(self["webpackChunk_N_E"]=self["webpackChunk_N_E"]||[]).push([[725],{210:(e,s,r)=>{"use strict";r.d(s,{AuthProvider:()=>f,A:()=>h});var a=r(5155);var t=r(2115);var n=r(5695);var o=r(5404);var c=r(5317);var i=r(3915);const l={apiKey:"AIzaSyDeO4RNogxdrDxOJEWfAbsyr67jh19fIFc",authDomain:"gesticom-4e956.firebaseapp.com",projectId:"gesticom-4e956",storageBucket:"gesticom-4e956.firebasestorage.app",messagingSenderId:"158166010651",appId:"1:158166010651:web:58b14e98489ea9046a61be"};const d=!(0,i.Dk)().length?(0,i.Wp)(l):(0,i.Sx)();const u=(0,o.xI)(d);const m=(0,c.aU)(d,"gesticom");const x=(0,t.createContext)(undefined);const h=()=>{const e=(0,t.useContext)(x);if(e===undefined){throw new Error("useAuth must be used within an AuthProvider")}return e};const f=e=>{let{children:s}=e;const[r,i]=(0,t.useState)(null);const[l,d]=(0,t.useState)(null);const[h,f]=(0,t.useState)(true);const p=(0,n.useRouter)();(0,t.useEffect)(()=>{const e=(0,o.hg)(u,async e=>{if(e){const s=await e.getIdToken();d(s);const r=await (0,c.x7)((0,c.H9)(m,"usuarios",e.uid));if(r.exists()){const s=r.data();i({id:e.uid,nombre:s.nombre||"Usuario",rut:s.rut||"",email:e.email||"",rol:s.rol||"vendedor"})}}else{i(null);d(null)}f(false)});return()=>e()},[]);const v=async(e,s)=>{await (0,o.x9)(u,e,s);p.push("/inventario")};const g=async()=>{await (0,o.CI)(u);p.push("/login")};const j=e=>{if(!r)return false;const s=Array.isArray(e)?e:[e];return s.includes(r.rol)};return(0,a.jsx)(x.Provider,{value:{usuario:r,token:l,login:v,logout:g,isLoading:h,isAuthenticated:!!r,hasRole:j},children:s})}},1602:(e,s,r)=>{"use strict";r.r(s);r.d(s,{"default":()=>S});var a=r(5155);var t=r(2115);var n=r(5695);var o=r(210);var c=r(8482);var i=r(7168);var l=r(9852);var d=r(8145);var u=r(7489);var m=r(3999);const x=t.forwardRef((e,s)=>{let{className:r,orientation:t="horizontal",decorative:n=true,...o}=e;return(0,a.jsx)(u.b,{ref:s,decorative:n,orientation:t,className:(0,m.cn)("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",r),...o})});x.displayName=u.b.displayName;var h=r(7655);const f=t.forwardRef((e,s)=>{let{className:r,children:t,...n}=e;return(0,a.jsxs)(h.bL,{ref:s,className:(0,m.cn)("relative overflow-hidden",r),...n,children:[(0,a.jsx)(h.LM,{className:"h-full w-full rounded-[inherit]",children:t}),(0,a.jsx)(p,{}),(0,a.jsx)(h.OK,{})]})});f.displayName=h.bL.displayName;const p=t.forwardRef((e,s)=>{let{className:r,orientation:t="vertical",...n}=e;return(0,a.jsx)(h.VM,{ref:s,orientation:t,className:(0,m.cn)("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...n,children:(0,a.jsx)(h.lr,{className:"relative flex-1 rounded-full bg-border"})})});p.displayName=h.VM.displayName;var v=r(7550);var g=r(7809);var j=r(9676);var b=r(7901);var N=r(7924);var y=r(7108);var w=r(4616);var k=r(4416);var R=r(2525);var C=r(7712);var A=r(5868);var E=r(6671);function S(){const{usuario:e,isAuthenticated:s,isLoading:r,hasRole:u}=(0,o.A)();const m=(0,n.useRouter)();const[h,p]=(0,t.useState)([]);const[S,z]=(0,t.useState)([]);const[$,B]=(0,t.useState)("");const[P,_]=(0,t.useState)("");const[I,V]=(0,t.useState)([]);const[F,Z]=(0,t.useState)("venta");const[D,O]=(0,t.useState)(false);(0,t.useEffect)(()=>{if(!r&&!s){m.push("/login")}},[s,r,m]);(0,t.useEffect)(()=>{if(s){T();W()}},[s]);const T=async()=>{try{const e=await fetch("http://localhost:3001/api/productos");if(e.ok){const s=await e.json();p(s)}}catch(e){console.error("Error al cargar productos:",e);E.oR.error("Error al cargar productos")}};const W=async()=>{try{const e=localStorage.getItem("token");const s=await fetch("http://localhost:3001/api/ventas",{headers:{Authorization:"Bearer ".concat(e)}});if(s.ok){const e=await s.json();V(e)}}catch(e){console.error("Error al cargar ventas:",e)}};const L=async()=>{if(!P.trim())return;const e=h.find(e=>e.codigo===P.trim());if(e){M(e);_("")}else{E.oR.error("Producto no encontrado")}};const H=h.filter(e=>e.nombre.toLowerCase().includes($.toLowerCase())||e.codigo.includes($));const M=e=>{if(e.stock<=0){E.oR.error("Producto sin stock");return}const s=S.find(s=>s.producto.id===e.id);if(s){if(s.cantidad>=e.stock){E.oR.error("No hay suficiente stock");return}K(e.id,s.cantidad+1)}else{const s={producto:e,cantidad:1,subtotal:e.precio};z([...S,s]);E.oR.success("".concat(e.nombre," agregado al carrito"))}};const K=(e,s)=>{if(s<=0){U(e);return}const r=h.find(s=>s.id===e);if(r&&s>r.stock){E.oR.error("No hay suficiente stock");return}z(S.map(r=>r.producto.id===e?{...r,cantidad:s,subtotal:r.producto.precio*s}:r))};const U=e=>{z(S.filter(s=>s.producto.id!==e))};const J=()=>{return S.reduce((e,s)=>e+s.subtotal,0)};const Q=async()=>{if(S.length===0){E.oR.error("El carrito est\xe1 vac\xedo");return}O(true);try{const e=localStorage.getItem("token");const s={items:S.map(e=>({producto_id:e.producto.id,cantidad:e.cantidad,precio_unitario:e.producto.precio})),total:J()};const r=await fetch("http://localhost:3001/api/ventas",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(s)});if(r.ok){E.oR.success("Venta procesada exitosamente");z([]);T();W()}else{const e=await r.json();E.oR.error(e.message||"Error al procesar la venta")}}catch(e){console.error("Error al procesar venta:",e);E.oR.error("Error al procesar la venta")}finally{O(false)}};const X=async e=>{if(!u("due\xf1o")){E.oR.error("No tienes permisos para anular ventas");return}try{const s=localStorage.getItem("token");const r=await fetch("http://localhost:3001/api/ventas/".concat(e,"/anular"),{method:"PUT",headers:{Authorization:"Bearer ".concat(s)}});if(r.ok){E.oR.success("Venta anulada exitosamente");W();T()}else{E.oR.error("Error al anular la venta")}}catch(e){console.error("Error al anular venta:",e);E.oR.error("Error al anular la venta")}};if(r){return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}if(!s||!e){return null}return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)(i.$,{variant:"ghost",size:"sm",onClick:()=>m.push("/dashboard"),children:[(0,a.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Dashboard"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(g.A,{className:"h-6 w-6 text-primary"}),(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"M\xf3dulo de Ventas"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(i.$,{variant:F==="venta"?"default":"outline",size:"sm",onClick:()=>Z("venta"),children:[(0,a.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"Nueva Venta"]}),(0,a.jsxs)(i.$,{variant:F==="historial"?"default":"outline",size:"sm",onClick:()=>Z("historial"),children:[(0,a.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Historial"]})]})]})})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:F==="venta"?(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"flex items-center",children:[(0,a.jsx)(b.A,{className:"h-5 w-5 mr-2"}),"Esc\xe1ner de C\xf3digo de Barras"]})}),(0,a.jsx)(c.Wu,{children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(l.p,{placeholder:"Escanea o ingresa el c\xf3digo de barras",value:P,onChange:e=>_(e.target.value),onKeyPress:e=>e.key==="Enter"&&L()}),(0,a.jsx)(i.$,{onClick:L,children:(0,a.jsx)(N.A,{className:"h-4 w-4"})})]})})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"flex items-center",children:[(0,a.jsx)(y.A,{className:"h-5 w-5 mr-2"}),"Buscar Productos"]})}),(0,a.jsxs)(c.Wu,{children:[(0,a.jsx)(l.p,{placeholder:"Buscar por nombre o c\xf3digo...",value:$,onChange:e=>B(e.target.value),className:"mb-4"}),(0,a.jsx)(f,{className:"h-96",children:(0,a.jsx)("div",{className:"space-y-2",children:H.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>M(e),children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-medium",children:e.nombre}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["C\xf3digo: ",e.codigo]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,a.jsxs)("span",{className:"text-lg font-bold text-green-600",children:["$",typeof e.precio==="number"?e.precio.toFixed(2):Number(e.precio||0).toFixed(2)]}),(0,a.jsxs)(d.E,{variant:e.stock>0?"secondary":"destructive",children:["Stock: ",e.stock]})]})]}),(0,a.jsx)(i.$,{size:"sm",disabled:e.stock<=0,children:(0,a.jsx)(w.A,{className:"h-4 w-4"})})]},e.id))})})]})]})]}),(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)(g.A,{className:"h-5 w-5 mr-2"}),"Carrito (",S.length,")"]}),S.length>0&&(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>z([]),children:(0,a.jsx)(k.A,{className:"h-4 w-4"})})]})}),(0,a.jsxs)(c.Wu,{children:[S.length===0?(0,a.jsx)("p",{className:"text-center text-gray-500 py-8",children:"El carrito est\xe1 vac\xedo"}):(0,a.jsx)(f,{className:"h-64",children:(0,a.jsx)("div",{className:"space-y-3",children:S.map(e=>(0,a.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-sm",children:e.producto.nombre}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>U(e.producto.id),children:(0,a.jsx)(R.A,{className:"h-3 w-3"})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>K(e.producto.id,e.cantidad-1),children:(0,a.jsx)(C.A,{className:"h-3 w-3"})}),(0,a.jsx)("span",{className:"w-8 text-center",children:e.cantidad}),(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>K(e.producto.id,e.cantidad+1),children:(0,a.jsx)(w.A,{className:"h-3 w-3"})})]}),(0,a.jsxs)("span",{className:"font-bold",children:["$",e.subtotal?Number(e.subtotal).toFixed(2):"0.00"]})]})]},e.producto.id))})}),S.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x,{className:"my-4"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,a.jsx)("span",{children:"Total:"}),(0,a.jsxs)("span",{children:["$",Number(J()||0).toFixed(2)]})]}),(0,a.jsxs)(i.$,{className:"w-full",onClick:Q,disabled:D,children:[(0,a.jsx)(A.A,{className:"h-4 w-4 mr-2"}),D?"Procesando...":"Procesar Venta"]})]})]})]})]})})]}):(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"flex items-center",children:[(0,a.jsx)(j.A,{className:"h-5 w-5 mr-2"}),"Historial de Ventas"]})}),(0,a.jsx)(c.Wu,{children:(0,a.jsx)(f,{className:"h-96",children:(0,a.jsx)("div",{className:"space-y-4",children:I.map(e=>{var s;return(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-medium",children:["Venta #",e.id]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:new Date(e.fecha).toLocaleString()})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-lg font-bold",children:["$",e.total.toFixed(2)]}),(0,a.jsx)(d.E,{variant:e.estado==="activa"?"default":"destructive",children:e.estado})]})]}),(0,a.jsx)("div",{className:"space-y-1 mb-3",children:(s=e.items)===null||s===void 0?void 0:s.map((e,s)=>(0,a.jsxs)("div",{className:"text-sm flex justify-between",children:[(0,a.jsxs)("span",{children:[e.cantidad,"x ",e.producto_nombre]}),(0,a.jsxs)("span",{children:["$",(e.cantidad*e.precio_unitario).toFixed(2)]})]},s))}),u("due\xf1o")&&e.estado==="activa"&&(0,a.jsx)(i.$,{variant:"destructive",size:"sm",onClick:()=>X(e.id),children:"Anular Venta"})]},e.id)})})})})]})})]})}},3999:(e,s,r)=>{"use strict";r.d(s,{cn:()=>n});var a=r(2596);var t=r(9688);function n(){for(var e=arguments.length,s=new Array(e),r=0;r<e;r++){s[r]=arguments[r]}return(0,t.QP)((0,a.$)(s))}},5113:(e,s,r)=>{Promise.resolve().then(r.bind(r,1602))},7168:(e,s,r)=>{"use strict";r.d(s,{$:()=>l});var a=r(5155);var t=r(2115);var n=r(9708);var o=r(2085);var c=r(3999);const i=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}});const l=t.forwardRef((e,s)=>{let{className:r,variant:t,size:o,asChild:l=false,...d}=e;const u=l?n.DX:"button";return(0,a.jsx)(u,{className:(0,c.cn)(i({variant:t,size:o,className:r})),ref:s,...d})});l.displayName="Button"},8145:(e,s,r)=>{"use strict";r.d(s,{E:()=>i});var a=r(5155);var t=r(2115);var n=r(2085);var o=r(3999);const c=(0,n.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:s,variant:r,...t}=e;return(0,a.jsx)("div",{className:(0,o.cn)(c({variant:r}),s),...t})}},8482:(e,s,r)=>{"use strict";r.d(s,{BT:()=>l,Wu:()=>d,ZB:()=>i,Zp:()=>o,aR:()=>c});var a=r(5155);var t=r(2115);var n=r(3999);const o=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...t})});o.displayName="Card";const c=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...t})});c.displayName="CardHeader";const i=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...t})});i.displayName="CardTitle";const l=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",r),...t})});l.displayName="CardDescription";const d=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("p-6 pt-0",r),...t})});d.displayName="CardContent";const u=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("flex items-center p-6 pt-0",r),...t})});u.displayName="CardFooter"},9852:(e,s,r)=>{"use strict";r.d(s,{p:()=>o});var a=r(5155);var t=r(2115);var n=r(3999);const o=t.forwardRef((e,s)=>{let{className:r,type:t,...o}=e;return(0,a.jsx)("input",{type:t,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:s,...o})});o.displayName="Input"}},e=>{var s=s=>e(e.s=s);e.O(0,[135,204,896,455,206,441,684,358],()=>s(5113));var r=e.O();_N_E=r}]);